<ng-container *ngIf="mostrarModal">
  <div class="fixed inset-0 z-[100000] flex items-center justify-center">
    <div class="absolute inset-0 bg-black bg-opacity-50"></div>

      <div class="relative bg-white rounded-xl p-6 w-full max-w-3xl sm:w-[90%] h-[93vh] sm:h-[93%] shadow-lg z-10 flex flex-col">

      <!-- Modal Header -->
      <div class="flex justify-between items-center mb-3">
        <h2 class="text-2xl font-bold">Checkout</h2>
        <button (click)="cerrar()" class="text-2xl text-gray-600 hover:text-gray-800">✕</button>
      </div>

      <!-- Modal Body (Contact + Carrito) -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-4 flex-grow overflow-hidden md:h-full">
  
  <!-- Contact Info -->
  <div class="flex flex-col overflow-hidden">
    <h4 class="text-lg font-semibold mb-2">Medio de pago</h4>
    <div class="w-full max-w-xs">
      <select id="metodoPago"
              name="metodoPago"
              class="block w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              [(ngModel)]="medioDePago">
        <option [ngValue]="null" disabled selected>Seleccioná un medio de pago</option>
        <option *ngFor="let medio of mediosDePago" [ngValue]="medio">
          {{ medio.nombre }}
        </option>
      </select>
    </div>

    <!-- Pedidos Ya Toggle -->
    <div class="flex items-center mt-4">
      <label for="pedidoYa" class="mr-3 text-sm font-medium text-gray-700">Pedidos Ya</label>
      <input type="checkbox" id="pedidoYa" class="toggle-checkbox hidden" [(ngModel)]="pedidoYaModel" />
      <label for="pedidoYa" class="toggle-label block w-12 h-6 rounded-full bg-gray-300 cursor-pointer relative">
        <span class="absolute left-1 top-1 w-4 h-4 bg-white rounded-full shadow transition-transform duration-300"></span>
      </label>
    </div>

    <!-- Xubio Toggle -->
    <div class="flex items-center mt-4">
      <label for="xubio" class="mr-3 text-sm font-medium text-gray-700">Xubio</label>
      <input type="checkbox" id="xubio" class="toggle-checkbox hidden" [(ngModel)]="xubioModel" />
      <label for="xubio" class="toggle-label block w-12 h-6 rounded-full bg-gray-300 cursor-pointer relative">
        <span class="absolute left-1 top-1 w-4 h-4 bg-white rounded-full shadow transition-transform duration-300"></span>
      </label>
    </div>

    <!-- Descuento -->
    <div class="w-full max-w-xs mt-4">
      <label class="block text-sm font-medium text-gray-700 mb-2">Descuento</label>
      <div class="flex items-center gap-2">
        <select [(ngModel)]="tipoDescuento"
                (ngModelChange)="aplicarDescuento(); validarTipoDescuento($event)"
                class="w-1/2 p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500">
          <option value="porcentaje">Porcentaje</option>
          <option value="monto">Monto fijo</option>
        </select>

        <input type="number"
               [(ngModel)]="numeroDescuento"
               (ngModelChange)="aplicarDescuento()"
               (input)="validarDescuento($event)"
               class="w-1/2 p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500"
               min="0"
               [max]="tipoDescuento === 'porcentaje' ? 100 : subtotal()" />
      </div>
    </div>
  </div>

  <!-- Carrito -->
  <div class="flex flex-col overflow-hidden h-full">
    <h4 class="text-lg font-semibold mb-2">Carrito</h4>
    <div class="overflow-y-auto p-2 flex-1 min-h-0">
      <div>
        <app-checkout-item *ngFor="let articulo of carrito()"
                           [articulo]="articulo"
                           [pedidoYa]="pedidoYa()"
                           (actualizarData)="actualizarData()">
        </app-checkout-item>
      </div>
    </div>
  </div>
</div>


      <!-- Resumen + Botón -->
      <div class="pt-2 border-t">
        <h4 class="text-lg font-semibold mb-2">Resumen</h4>
        <div class="flex justify-between">
          <span>Total sin descuentos: </span>
          <span>{{subtotal() | currency}}</span>
        </div>
        <div class="flex justify-between">
          <span>Descuento: </span>
          <span>{{montoDescuento() | currency}}</span>
        </div>
        <div class="flex justify-between font-bold">
          <span>Total: </span>
          <span><b>{{totalConDescuento() | currency}}</b></span>
        </div>

        <button 
          (click)="guardarVenta()" 
          [disabled]="procesandoVenta"
          class="w-full mt-3 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-800 transition-colors">
          Guardar
        </button>
      </div>

    </div>
  </div>
</ng-container>
